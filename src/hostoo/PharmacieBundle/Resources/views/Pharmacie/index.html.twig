{% extends 'hostooSanteBundle::blank.html.twig' %}
{% block titre %}{{ parent() }}::Pharmacie{% endblock %}
{% block titrepage %}Pharmacie{% endblock %}
{% block menu %}
    {% include 'hostooUserBundle:menus:menuphar.html.twig' %}
{% endblock %}
{% block body %}

    <!-- Liste de médicaments -->
    <!-- Tabs Left -->
    <ul class="nav nav-tabs">
        <li role="presentation"><a href="#tabr1" role="tab" data-toggle="tab">Produits enregistrés</a></li>
        <li role="presentation"><a href="#tabr3" role="tab" data-toggle="tab">ordonnances</a></li>
    </ul>
    <div class="tab-content">
    <div id="tabr1"  role="tabpanel" class="tab-pane fade in active">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">Produits</div>
                <div class="panel-body">
                    <form>
                        <label class="col-lg-12"><u>Liste</u> :</label><br>
                        <table id="produit" class="table table-striped table-bordered" width="100%" cellspacing="0">
                            <thead>
                            <tr>

                                <th>Designation</th>
                                <th>Nb Plqt.</th>
                                <th>Nb unités.</th>
                                <th>Prix</th>
                                <th>PU</th>
                                <th>Qte</th>

                                <th>Val. stock CDF </th>
                                <th>Val. stock USD </th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            {% set prix=0 %}
                            {% for produit in produits %}
                                <tr>
                                    <td>{{ produit.nom }}</td>
                                    <td>{{ produit.plaquette }}</td>
                                    <td>{{ produit.unite }}</td>
                                    <td>{{ produit.prix }}</td>
                                    <td>{% if produit.unite*produit.plaquette > 0 and produit.unite  %}{{ produit.prix/(produit.unite*produit.plaquette) }} {% endif %}</td>
                                    <td>{% if produit.stocktot is not null %} {{ produit.stocktot.qte }} {% else  %} 0 {% endif %}  </td>
                                    <td>
                                        {% if produit.stocktot is not null and produit.unite*produit.plaquette > 0 %} {{ produit.prix/(produit.unite*produit.plaquette)*produit.stocktot.qte }} {% else %}0{% endif %}                                    </td>
                                        {% if produit.stocktot is not null and produit.unite*produit.plaquette > 0 %}
                                        {% set prix = prix + (produit.prix/(produit.unite*produit.plaquette)*produit.stocktot.qte) %}

                                        {% else %}
                                            {% set prix = prix + 0 %}
                                        {% endif %}
                                    <td>
                                        {% if produit.stocktot is not null and produit.unite*produit.plaquette > 0 %}
                                            {{ produit.prix/(produit.unite*produit.plaquette)*produit.stocktot.qte/render(controller('hostooSanteBundle:Caisse:monTaux')) }}
                                        {% else %}0{% endif %}
                                        {% if produit.stocktot is not null and produit.unite*produit.plaquette > 0 %}
                                        {% set prix = prix + (produit.prix/(produit.unite*produit.plaquette)*produit.stocktot.qte/render(controller('hostooSanteBundle:Caisse:monTaux'))) %}

                                        {% else %}
                                            {% set prix = prix + 0 %}
                                        {% endif %}
                                    </td>
                                        <td>
                                        <a href="{{ path('hp_produit',{'id': produit.id}) }}" class="btn btn-sm btn-info"><i class="fa fa-eye"></i></a>
                                        <a href="{{ path('hp_modifproduit',{'id': produit.id}) }}" class="btn btn-sm btn-warning"><i class="fa fa-edit"></i></a>

                                    </td>
                                </tr>
                            {% endfor %}

                            </tbody>
                            <tfoot>
                            <tr>
                                <th colspan="6">Valeur en Stock</th>
                                <th>{{ prix }} CDF</th>
                                <th>{{ prix/render(controller('hostooSanteBundle:Caisse:monTaux')) }} USD</th>
                                <th></th>
                            </tr>
                            </tfoot>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div></div>
    <div id="tabr3"   role="tabpanel" class="tab-pane fade" ><!-- Sixième onglet -->
    <div class="row">
    <div class="col-lg-12">
        <div >
            <table class="table table-striped table-bordered" width="100%" cellspacing="0">
                <thead>
                <tr>
                    <th>Patient</th>
                    <th>Date</th>
                    <th>Medecin</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for ord in ordonnances %}
                <tr>
                    <td>{% if ord.episode %}{{ ord.episode.patient.nom }}{% else %}{{ ord.hospitalisation.patient.nom }}{% endif %}</td>
                    <td>{{ ord.dateordo|date('d-m-Y') }}</td>
                    <td>&nbsp;{{ ord.medecin }}</td>
                        {% if ord.livre==0 %}
                        <td colspan="3"><a href="{{ path('hp_ordonnance',{'id':ord.id}) }}"><button>Afficher</button></a> </td>
                        {% else %}
                            <td colspan="3"><a href="{{ path('hp_ordonnance',{'id':ord.id}) }}"><button class="btn btn-success"><i class="fa fa-check text-white"></i> </button></a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    </div></div>
</div>
{% endblock %}
{% block stytesheets %}
    {{ parent() }}
    <link href="{{ asset('assets/plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/plugins/multiselect/css/multi-select.css') }}"  rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/plugins/select2/dist/css/select2.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('assets/plugins/select2/dist/css/select2-bootstrap.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('assets/plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/plugins/switchery/switchery.min.css') }}" rel="stylesheet" />
    <link href="{{ asset('assets/plugins/timepicker/bootstrap-timepicker.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/plugins/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/plugins/bootstrap-daterangepicker/daterangepicker.css') }}" rel="stylesheet">
    {% include 'hostooSanteBundle:plugins:datatable.style.html.twig' %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <!-- Plugins Js -->
    <script src="{{ asset('assets/plugins/switchery/switchery.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/plugins/multiselect/js/jquery.multi-select.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/plugins/jquery-quicksearch/jquery.quicksearch.js') }}"></script>
    <script src="{{ asset('assets/plugins/select2/dist/js/select2.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/plugins/bootstrap-inputmask/bootstrap-inputmask.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/plugins/moment/moment.js') }}"></script>
    <script src="{{ asset('assets/plugins/timepicker/bootstrap-timepicker.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/bootstrap-daterangepicker/daterangepicker.js') }}"></script>
    <script src="{{ asset('assets/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js') }}" type="text/javascript"></script>
    {% include 'hostooSanteBundle:plugins:datatable.scripts.html.twig' %}
    <script>
        $(function () {
           $('.table').dataTable({
               dom: 'Bfrtip',
               buttons: [
                   { extend: 'copyHtml5', footer: true },
                   { extend: 'excel', footer: true },
                   { extend: 'csvHtml5', footer: true },
                   { extend: 'pdfHtml5', footer: true }
               ]
           } );

            // Date Picker
            jQuery('#datepicker').datepicker();
            jQuery('#datepicker-autoclose').datepicker({
                autoclose: true,
                todayHighlight: true
            });
        });
    </script>
{% endblock %}